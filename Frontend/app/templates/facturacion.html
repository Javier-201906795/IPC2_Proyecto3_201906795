<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Factura de Consumo - Datacenter</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body { background: #f5f7fb; }
      .card-centered { max-width: 80rem; width: 100%; }
      .highlight-card { border-radius: .75rem; }
      .highlight-card h2 { font-size: 1.6rem; margin: 0; }
      .summary-badge { font-size: .8rem; text-transform: uppercase; letter-spacing: .05rem; }
      .accordion-button:not(.collapsed) { color: #0d6efd; background-color: rgba(13, 110, 253, .05); }
      .table thead th { white-space: nowrap; }
      .print-toolbar { background: #ffffff; border-bottom: 1px solid rgba(0, 0, 0, 0.075); }
      .print-toolbar .container { max-width: 80rem; }
      @media print {
        .print-toolbar { display: none !important; }
        body { background: #ffffff; }
        .card { box-shadow: none !important; border: none !important; }
      }
    </style>
  </head>
  <body>

    <header class="print-toolbar py-2">
      <div class="container d-flex justify-content-between align-items-center px-3">
        <div class="fw-semibold">Factura de consumo · Datacenter</div>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.print()">Imprimir</button>
          <button type="button" class="btn btn-primary btn-sm" onclick="downloadFacturaPDF()">Descargar PDF</button>
        </div>
      </div>
    </header>

    <main class="py-5 d-flex justify-content-center">
      <div class="card shadow-sm card-centered">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start flex-wrap gap-3 mb-4">
            <div>
              <h1 class="card-title mb-1">Factura de Consumo</h1>
              <p class="text-muted mb-0">Detalle de instancias, horas consumidas y aporte de cada recurso al total facturado.</p>
            </div>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-12 col-md-4">
              <div class="highlight-card p-4 bg-primary text-white h-100">
                <div class="summary-badge opacity-75">Cliente</div>
                <h2 class="mt-2 mb-1">Soluciones Financieras GT</h2>
                <div class="small opacity-75">NIT 548796-K</div>
              </div>
            </div>
            <div class="col-6 col-md-4">
              <div class="highlight-card p-4 border bg-light h-100">
                <div class="summary-badge text-muted">Horas totales</div>
                <h2 class="mt-2 mb-1 text-primary">355 h</h2>
                <div class="small text-muted">4 instancias activas</div>
              </div>
            </div>
            <div class="col-6 col-md-4">
              <div class="highlight-card p-4 border bg-light h-100">
                <div class="summary-badge text-muted">Importe total</div>
                <h2 class="mt-2 mb-1 text-success">Q 11,408.00</h2>
                <div class="small text-muted">Cómputo, almacenamiento y red</div>
              </div>
            </div>
          </div>

          <div class="mb-4">
            <h2 class="h5 mb-3">Resumen por instancia</h2>
            <div class="table-responsive">
              <table class="table table-striped table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Instancia</th>
                    <th>Configuración</th>
                    <th>Nombre</th>
                    <th>Horas consumo</th>
                    <th>Recursos principales</th>
                    <th>Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>IN-9001</td>
                    <td>DB-XL</td>
                    <td>Core Bancario</td>
                    <td>120 h</td>
                    <td>
                      <div>RC-101 · 8 unidades</div>
                      <div>RC-204 · 4 unidades</div>
                    </td>
                    <td>Q 4,920.00</td>
                  </tr>
                  <tr>
                    <td>IN-9034</td>
                    <td>AN-CORE</td>
                    <td>Analytics Regional</td>
                    <td>95 h</td>
                    <td>
                      <div>RC-101 · 10 unidades</div>
                      <div>RC-310 · 4 unidades</div>
                    </td>
                    <td>Q 4,598.00</td>
                  </tr>
                  <tr>
                    <td>IN-9102</td>
                    <td>AN-EDGE</td>
                    <td>Seguimiento IoT</td>
                    <td>80 h</td>
                    <td>
                      <div>RC-310 · 6 unidades</div>
                      <div>RC-204 · 3 unidades</div>
                    </td>
                    <td>Q 708.00</td>
                  </tr>
                  <tr>
                    <td>IN-9140</td>
                    <td>DB-MED</td>
                    <td>Catálogo Omnicanal</td>
                    <td>60 h</td>
                    <td>
                      <div>RC-101 · 4 unidades</div>
                      <div>RC-310 · 2 unidades</div>
                    </td>
                    <td>Q 1,182.00</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="accordion" id="detalleRecursos">
            <div class="accordion-item">
              <h2 class="accordion-header" id="instanciaUnoHeading">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#instanciaUno" aria-expanded="true">
                  Instancia IN-9001 · Core Bancario
                </button>
              </h2>
              <div id="instanciaUno" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="row g-3 mb-3 small text-muted">
                    <div class="col-md-3"><strong>Cliente:</strong> Soluciones Financieras GT</div>
                    <div class="col-md-3"><strong>Periodo:</strong> 01-07 abr 2025</div>
                    <div class="col-md-3"><strong>Horas consumo:</strong> 120 h</div>
                    <div class="col-md-3"><strong>Subtotal:</strong> Q 4,920.00</div>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle">
                      <thead class="table-light">
                        <tr>
                          <th>Recurso</th>
                          <th>Métrica</th>
                          <th>Unidades</th>
                          <th>Horas</th>
                          <th>Tarifa por hora</th>
                          <th>Aporte</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>RC-101 · Compute Optimized</td>
                          <td>GHz reservados</td>
                          <td>8</td>
                          <td>120</td>
                          <td>Q 4.50</td>
                          <td>Q 4,320.00</td>
                        </tr>
                        <tr>
                          <td>RC-204 · Storage IOPS Alto</td>
                          <td>IOPS</td>
                          <td>4</td>
                          <td>120</td>
                          <td>Q 1.25</td>
                          <td>Q 600.00</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item">
              <h2 class="accordion-header" id="instanciaDosHeading">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#instanciaDos" aria-expanded="true">
                  Instancia IN-9034 · Analytics Regional
                </button>
              </h2>
              <div id="instanciaDos" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="row g-3 mb-3 small text-muted">
                    <div class="col-md-3"><strong>Cliente:</strong> Soluciones Financieras GT</div>
                    <div class="col-md-3"><strong>Periodo:</strong> 01-07 abr 2025</div>
                    <div class="col-md-3"><strong>Horas consumo:</strong> 95 h</div>
                    <div class="col-md-3"><strong>Subtotal:</strong> Q 4,598.00</div>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle">
                      <thead class="table-light">
                        <tr>
                          <th>Recurso</th>
                          <th>Métrica</th>
                          <th>Unidades</th>
                          <th>Horas</th>
                          <th>Tarifa por hora</th>
                          <th>Aporte</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>RC-101 · Compute Optimized</td>
                          <td>GHz reservados</td>
                          <td>10</td>
                          <td>95</td>
                          <td>Q 4.50</td>
                          <td>Q 4,275.00</td>
                        </tr>
                        <tr>
                          <td>RC-310 · Red 10Gbps</td>
                          <td>Gbps</td>
                          <td>4</td>
                          <td>95</td>
                          <td>Q 0.85</td>
                          <td>Q 323.00</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item">
              <h2 class="accordion-header" id="instanciaTresHeading">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#instanciaTres" aria-expanded="true">
                  Instancia IN-9102 · Seguimiento IoT
                </button>
              </h2>
              <div id="instanciaTres" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="row g-3 mb-3 small text-muted">
                    <div class="col-md-3"><strong>Cliente:</strong> Retail Digital Centroamérica</div>
                    <div class="col-md-3"><strong>Periodo:</strong> 01-07 abr 2025</div>
                    <div class="col-md-3"><strong>Horas consumo:</strong> 80 h</div>
                    <div class="col-md-3"><strong>Subtotal:</strong> Q 708.00</div>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle">
                      <thead class="table-light">
                        <tr>
                          <th>Recurso</th>
                          <th>Métrica</th>
                          <th>Unidades</th>
                          <th>Horas</th>
                          <th>Tarifa por hora</th>
                          <th>Aporte</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>RC-310 · Red 10Gbps</td>
                          <td>Gbps</td>
                          <td>6</td>
                          <td>80</td>
                          <td>Q 0.85</td>
                          <td>Q 408.00</td>
                        </tr>
                        <tr>
                          <td>RC-204 · Storage IOPS Alto</td>
                          <td>IOPS</td>
                          <td>3</td>
                          <td>80</td>
                          <td>Q 1.25</td>
                          <td>Q 300.00</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item">
              <h2 class="accordion-header" id="instanciaCuatroHeading">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#instanciaCuatro" aria-expanded="true">
                  Instancia IN-9140 · Catálogo Omnicanal
                </button>
              </h2>
              <div id="instanciaCuatro" class="accordion-collapse collapse show">
                <div class="accordion-body">
                  <div class="row g-3 mb-3 small text-muted">
                    <div class="col-md-3"><strong>Cliente:</strong> Retail Digital Centroamérica</div>
                    <div class="col-md-3"><strong>Periodo:</strong> 01-07 abr 2025</div>
                    <div class="col-md-3"><strong>Horas consumo:</strong> 60 h</div>
                    <div class="col-md-3"><strong>Subtotal:</strong> Q 1,182.00</div>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-sm table-striped align-middle">
                      <thead class="table-light">
                        <tr>
                          <th>Recurso</th>
                          <th>Métrica</th>
                          <th>Unidades</th>
                          <th>Horas</th>
                          <th>Tarifa por hora</th>
                          <th>Aporte</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>RC-101 · Compute Optimized</td>
                          <td>GHz reservados</td>
                          <td>4</td>
                          <td>60</td>
                          <td>Q 4.50</td>
                          <td>Q 1,080.00</td>
                        </tr>
                        <tr>
                          <td>RC-310 · Red 10Gbps</td>
                          <td>Gbps</td>
                          <td>2</td>
                          <td>60</td>
                          <td>Q 0.85</td>
                          <td>Q 102.00</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-5">
            <div class="highlight-card p-4 border bg-light d-flex justify-content-between align-items-center">
              <div class="summary-badge text-muted">Total factura</div>
              <div class="fs-3 fw-bold text-success">Q 11,408.00</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script>
      function downloadFacturaPDF() {
        const { jsPDF } = window.jspdf;
        const factura = document.querySelector('.card-centered');
        if (!factura) { return; }

        const originalScrollY = window.scrollY;
        window.scrollTo(0, 0);

        html2canvas(factura, { scale: 2, useCORS: true }).then(canvas => {
          const pdf = new jsPDF('p', 'mm', 'a4');
          const pageWidth = pdf.internal.pageSize.getWidth();
          const pageHeight = pdf.internal.pageSize.getHeight();
          const imgWidth = pageWidth;
          const imgHeight = canvas.height * imgWidth / canvas.width;
          const imgData = canvas.toDataURL('image/png');

          let heightLeft = imgHeight;
          let position = 0;

          pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;

          while (heightLeft > 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
          }

          pdf.save('FacturaConsumo.pdf');
          window.scrollTo(0, originalScrollY);
        });
      }
    </script>
  </body>
</html>
